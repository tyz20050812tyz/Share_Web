<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸­å¿ƒ - ä»¥å²ä¸ºé‰´ï¼Œå‡èšåŠ›é‡</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="site-header">
        <div class="wrap">
            <h1>ğŸ›ï¸ ä¸ªäººä¸­å¿ƒ</h1>
            <nav class="main-nav">
                <a href="index.html">ä¸»é¡µ</a>
                <a href="ai.html">æ™ºèƒ½é—®ç­”</a>
                <a href="knowledge.html">çŸ¥è¯†åˆ†äº«</a>
                <a href="culture.html">æ–‡åŒ–ä¼ æ’­</a>
                <a href="discuss.html">è®¨è®ºåŒº</a>
                <a href="game.html">è¶£å‘³å°„å‡»</a>
                <a href="models.html">3Då±•é¦†</a>
                <a href="challenge.html" class="nav-challenge">ğŸ¯ äº’åŠ¨å­¦ä¹ </a>
                <a href="history_today.html" class="nav-history">ğŸ“… å†å²ä¸Šçš„ä»Šå¤©</a>
                <a href="contest.html" class="nav-contest">ğŸ† åˆ›ä½œç«èµ›</a>
                <a href="contest_works.html">ğŸ“š ä½œå“å±•ç¤º</a>
                <a href="profile.html" class="nav-profile active">ğŸ‘¤ ä¸ªäººä¸­å¿ƒ</a>
            </nav>
        </div>
    </header>

    <div class="user-bar" id="userBar"></div>

    <div class="wrap" style="max-width:1200px;">
        <!-- ä¸ªäººä¿¡æ¯å¡ç‰‡ -->
        <div class="card" style="margin-top:20px;text-align:center;padding:40px;background:linear-gradient(135deg,#fff5f5,#fde7e7);position:relative;overflow:hidden;">
            <div style="position:absolute;top:-20px;right:-20px;font-size:150px;opacity:0.1;">ğŸ¯</div>
            <div style="width:140px;height:140px;border-radius:50%;background:linear-gradient(135deg,#c62828,#e53935);margin:0 auto 20px;font-size:70px;color:white;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 32px rgba(198,40,40,0.3);border:5px solid white;">
                <span id="user-avatar">ğŸ‘¤</span>
            </div>
            <div style="font-size:36px;font-weight:bold;margin-bottom:10px;" id="user-name">æ¸¸å®¢</div>
            <div style="font-size:18px;color:#666;background:rgba(198,40,40,0.1);padding:5px 20px;border-radius:20px;display:inline-block;" id="user-role">æ™®é€šç”¨æˆ·</div>
        </div>

        <!-- æ•°æ®æ€»è§ˆ -->
        <div class="stats-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin:30px 0;">
            <div class="stat-card card" style="border-left:4px solid #4caf50;">
                <div style="font-size:48px;margin-bottom:10px;">ğŸ’¬</div>
                <div style="font-size:14px;color:#666;margin-bottom:8px;">è®¨è®ºå‘å¸–</div>
                <div style="font-size:32px;font-weight:bold;color:#4caf50;" id="discuss-posts">0</div>
            </div>
            <div class="stat-card card" style="border-left:4px solid #673ab7;">
                <div style="font-size:48px;margin-bottom:10px;">âœï¸</div>
                <div style="font-size:14px;color:#666;margin-bottom:8px;">ç«èµ›ä½œå“</div>
                <div style="font-size:32px;font-weight:bold;color:#673ab7;" id="contest-works">0</div>
            </div>
            <div class="stat-card card" style="border-left:4px solid #ff9800;">
                <div style="font-size:48px;margin-bottom:10px;">ğŸ®</div>
                <div style="font-size:14px;color:#666;margin-bottom:8px;">æ¸¸æˆå±€æ•°</div>
                <div style="font-size:32px;font-weight:bold;color:#ff9800;" id="games-played">0</div>
            </div>
            <div class="stat-card card" style="border-left:4px solid #f44336;">
                <div style="font-size:48px;margin-bottom:10px;">ğŸ¯</div>
                <div style="font-size:14px;color:#666;margin-bottom:8px;">ç­”é¢˜å¾—åˆ†</div>
                <div style="font-size:32px;font-weight:bold;color:#f44336;" id="quiz-score">0</div>
            </div>
        </div>

        <!-- æ ‡ç­¾é¡µ -->
        <div class="card" style="padding:20px;">
            <div style="display:flex;gap:10px;border-bottom:2px solid #eee;margin-bottom:30px;flex-wrap:wrap;">
                <button class="tab-btn active" data-tab="game" style="padding:12px 24px;background:transparent;border:none;border-bottom:3px solid #c62828;cursor:pointer;font-size:16px;font-weight:600;color:#c62828;">
                    ğŸ® æ¸¸æˆæˆ˜ç»©
                </button>
                <button class="tab-btn" data-tab="discuss" style="padding:12px 24px;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-size:16px;font-weight:600;color:#666;">
                    ğŸ’¬ è®¨è®ºåŠ¨æ€
                </button>
                <button class="tab-btn" data-tab="contest" style="padding:12px 24px;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-size:16px;font-weight:600;color:#666;">
                    âœï¸ åˆ›ä½œè®°å½•
                </button>
                <button class="tab-btn" data-tab="challenge" style="padding:12px 24px;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-size:16px;font-weight:600;color:#666;">
                    ğŸ“ ç­”é¢˜æ’è¡Œ
                </button>
            </div>

            <!-- æ¸¸æˆæˆ˜ç»©æ ‡ç­¾ -->
            <div class="tab-content active" id="tab-game">
                <div id="game-stats"></div>
            </div>

            <!-- è®¨è®ºåŠ¨æ€æ ‡ç­¾ -->
            <div class="tab-content" id="tab-discuss" style="display:none;">
                <div id="discuss-activity"></div>
            </div>

            <!-- åˆ›ä½œè®°å½•æ ‡ç­¾ -->
            <div class="tab-content" id="tab-contest" style="display:none;">
                <div id="contest-activity"></div>
            </div>

            <!-- ç­”é¢˜æ’è¡Œæ ‡ç­¾ -->
            <div class="tab-content" id="tab-challenge" style="display:none;">
                <div id="challenge-stats"></div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="wrap">Â© 2025 ä»¥å²ä¸ºé‰´ï¼Œå‡èšåŠ›é‡</div>
    </footer>

    <script src="main.js"></script>
    <script>
        // æ ‡ç­¾é¡µåˆ‡æ¢
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.style.borderBottom = '3px solid transparent';
                    b.style.color = '#666';
                });
                btn.style.borderBottom = '3px solid #c62828';
                btn.style.color = '#c62828';

                document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                document.getElementById('tab-' + tab).style.display = 'block';
            });
        });

        // åŠ è½½ç”¨æˆ·ä¿¡æ¯
        function loadUserProfile() {
            const userName = localStorage.getItem('login_user') || 'æ¸¸å®¢';
            const userRole = localStorage.getItem('login_role') || 'user';
            document.getElementById('user-name').textContent = userName;
            document.getElementById('user-role').textContent = userRole === 'admin' ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·';
            document.getElementById('user-avatar').textContent = userName.charAt(0).toUpperCase();
        }

        // åŠ è½½è®¨è®ºåŒºæ•°æ®
        function loadDiscussData() {
            const posts = JSON.parse(localStorage.getItem('forum_posts_v1') || '[]');
            const userName = localStorage.getItem('login_user') || 'æ¸¸å®¢';
            const myPosts = posts.filter(p => p.author === userName);
            document.getElementById('discuss-posts').textContent = myPosts.length;

            const container = document.getElementById('discuss-activity');
            if (myPosts.length === 0) {
                container.innerHTML = '<div style="text-align:center;padding:40px;color:#999;">æš‚æ— è®¨è®ºè®°å½•</div>';
            } else {
                container.innerHTML = myPosts.slice(0, 5).map(p => `
                    <div style="background:rgba(198,40,40,0.05);padding:15px;border-radius:8px;margin-bottom:10px;">
                        <div style="font-weight:600;margin-bottom:5px;">${p.content.substring(0, 50)}...</div>
                        <div style="font-size:12px;color:#999;">${new Date(p.timestamp).toLocaleString()}</div>
                    </div>
                `).join('');
            }
        }

        // åŠ è½½ç«èµ›æ•°æ®
        async function loadContestData() {
            const userName = localStorage.getItem('login_user') || 'æ¸¸å®¢';

            try {
                // ä»æœåŠ¡å™¨åŠ è½½ç”¨æˆ·çš„æŠ•ç¨¿ä½œå“
                const response = await fetch(`/api/submissions?userId=${encodeURIComponent(userName)}`);
                const data = await response.json();

                if (data.ok && data.submissions) {
                    const myWorks = data.submissions.filter(s => s.status === 'published');
                    document.getElementById('contest-works').textContent = myWorks.length;

                    const container = document.getElementById('contest-activity');
                    if (myWorks.length === 0) {
                        container.innerHTML = '<div style="text-align:center;padding:40px;color:#999;">æš‚æ— ç«èµ›ä½œå“</div>';
                    } else {
                        container.innerHTML = myWorks.slice(0, 5).map(w => {
                            const date = new Date(w.createdAt).toLocaleString('zh-CN', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            return `
                                <div style="background:rgba(198,40,40,0.05);padding:15px;border-radius:8px;margin-bottom:10px;cursor:pointer;transition:all 0.3s;" 
                                     onmouseover="this.style.background='rgba(198,40,40,0.1)'" 
                                     onmouseout="this.style.background='rgba(198,40,40,0.05)'"
                                     onclick="location.href='contest_works.html?id=${w.id}'">
                                    <div style="display:flex;justify-content:space-between;align-items:start;">
                                        <div style="flex:1;">
                                            <div style="font-weight:600;margin-bottom:5px;font-size:16px;">${w.title}</div>
                                            <div style="font-size:12px;color:#999;margin-bottom:8px;">${date}</div>
                                            <div style="display:flex;gap:15px;font-size:13px;color:#666;">
                                                <span>ğŸ‘ ${w.votes || 0} æŠ•ç¥¨</span>
                                                <span>ğŸ‘ï¸ ${w.views || 0} æµè§ˆ</span>
                                                ${w.featured ? '<span style="color:#ffd700;">â­ ç²¾é€‰</span>' : ''}
                                            </div>
                                        </div>
                                        <div style="background:rgba(198,40,40,0.1);padding:4px 12px;border-radius:12px;font-size:12px;color:#c62828;">
                                            ${w.category || 'æ–‡ç« '}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                } else {
                    document.getElementById('contest-works').textContent = '0';
                    document.getElementById('contest-activity').innerHTML = '<div style="text-align:center;padding:40px;color:#999;">æš‚æ— ç«èµ›ä½œå“</div>';
                }
            } catch (error) {
                console.error('åŠ è½½ç«èµ›æ•°æ®å¤±è´¥:', error);
                document.getElementById('contest-works').textContent = '0';
                document.getElementById('contest-activity').innerHTML = '<div style="text-align:center;padding:40px;color:#f44336;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
            }
        }

        // åŠ è½½æ¸¸æˆæ•°æ®
        function loadGameData() {
            const stats = JSON.parse(localStorage.getItem('gameStats') || '{"gamesPlayed":0,"totalScore":0}');
            document.getElementById('games-played').textContent = stats.gamesPlayed || 0;

            const container = document.getElementById('game-stats');
            container.innerHTML = `
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">
                    <div style="background:rgba(198,40,40,0.05);padding:20px;border-radius:8px;border-left:4px solid #c62828;">
                        <div style="font-size:14px;color:#666;">æ€»å±€æ•°</div>
                        <div style="font-size:28px;font-weight:bold;color:#c62828;">${stats.gamesPlayed || 0}</div>
                    </div>
                    <div style="background:rgba(198,40,40,0.05);padding:20px;border-radius:8px;border-left:4px solid #c62828;">
                        <div style="font-size:14px;color:#666;">ç´¯è®¡å¾—åˆ†</div>
                        <div style="font-size:28px;font-weight:bold;color:#c62828;">${stats.totalScore || 0}</div>
                    </div>
                </div>
            `;
        }

        // åŠ è½½ç­”é¢˜æ•°æ®
        function loadChallengeData() {
            const userName = localStorage.getItem('login_user') || 'æ¸¸å®¢';
            const rankings = JSON.parse(localStorage.getItem('quiz_rankings') || '[]');
            const userRankings = rankings.filter(r => r.name === userName).sort((a, b) => b.score - a.score);

            const bestScore = userRankings.length > 0 ? userRankings[0].score : 0;
            document.getElementById('quiz-score').textContent = bestScore;

            const container = document.getElementById('challenge-stats');
            if (userRankings.length === 0) {
                container.innerHTML = '<div style="text-align:center;padding:40px;color:#999;">æš‚æ— ç­”é¢˜è®°å½•</div>';
            } else {
                container.innerHTML = userRankings.slice(0, 5).map((r, i) => `
                    <div style="background:rgba(198,40,40,0.05);padding:15px;border-radius:8px;margin-bottom:10px;display:flex;justify-content:space-between;">
                        <div>
                            <div style="font-weight:600;">ç¬¬ ${i + 1} æ¬¡ç­”é¢˜</div>
                            <div style="font-size:12px;color:#999;">ç­”å¯¹ ${r.correct}/${r.total} é¢˜</div>
                        </div>
                        <div style="font-size:24px;font-weight:bold;color:#c62828;">${r.score}åˆ†</div>
                    </div>
                `).join('');
            }
        }

        // é¡µé¢åŠ è½½
        window.addEventListener('load', () => {
            loadUserProfile();
            loadDiscussData();
            loadContestData();
            loadGameData();
            loadChallengeData();
        });
    </script>
</body>

</html>