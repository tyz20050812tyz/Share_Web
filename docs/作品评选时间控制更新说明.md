# 作品评选时间控制功能更新说明

## 更新时间
2025-11-02

## 更新内容

### 核心改进：竞赛状态控制

根据竞赛的状态（进行中/已结束），智能控制评奖和排名显示。

### 1. 获奖展示区域控制 ✅

#### 进行中的竞赛
- **不显示获奖区域**：获奖展示区完全隐藏
- **投票阶段**：用户可以自由投票和取消投票
- **实时统计**：显示当前票数，但不公布排名

#### 已结束的竞赛
- **显示获奖区域**：顶部显著位置展示获奖作品
- **评选结果**：按投票数评选出一、二、三等奖
- **排名展示**：作品卡片显示排名徽章（🥇🥈🥉）

### 2. 竞赛状态提示 ✅

#### 页面顶部说明
在页面标题下方添加了说明文字：
```
⚠️ 竞赛进行中：大家投票 | 竞赛结束后：公布获奖作品
```

#### 竞赛选择器状态
选择竞赛后，实时显示竞赛状态：
- **进行中**：🔵 投票进行中（绿色）
- **已结束**：⚫ 已结束，奖项已公布（灰色）

### 3. 排名徽章控制 ✅

#### 进行中的竞赛
- 不显示排名徽章
- 作品按票数排序但不显示名次
- 鼓励公平投票

#### 已结束的竞赛
- 显示排名徽章（按票数排序时）
- 前三名显示奖牌徽章
- 4-10名显示数字排名

### 4. 获奖标题说明 ✅

获奖区域标题更新为：
```
🏆 获奖作品 (竞赛已结束，按票数评选)
```

## 代码修改

### contest_works.js

#### loadWorks() 函数
```javascript
// 获取当前竞赛信息
const currentContest = this.contests.find(c => c.id === this.currentContestId);
const statusElement = document.getElementById('contestStatus');

if (currentContest) {
    if (currentContest.status === 'ongoing') {
        statusElement.innerHTML = '<span style="color: #4caf50;">🔵 投票进行中</span>';
    } else {
        statusElement.innerHTML = '<span style="color: #999;">⚫ 已结束，奖项已公布</span>';
    }
}
```

#### renderWinners() 函数
```javascript
// 如果竞赛还在进行中，不显示获奖区域
if (!currentContest || currentContest.status === 'ongoing') {
    winnersSection.style.display = 'none';
    return;
}
```

#### createWorkCard() 函数
```javascript
// 获取当前竞赛状态
const currentContest = this.contests.find(c => c.id === this.currentContestId);
const isContestEnded = currentContest && currentContest.status === 'ended';
const sortByVotes = document.getElementById('sortBy').value === 'votes';

// 只在竞赛结束且按票数排序时显示排名徽章
${sortByVotes && isContestEnded ? `
    <div class="work-rank ${rankClass}">${rankDisplay}</div>
` : ''}
```

### contest_works.html

#### 页面标题更新
```html
<div class="page-header">
    <h1>📚 作品展示与评选</h1>
    <p>浏览优秀作品,为心仪之作投上宝贵一票</p>
    <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.9;">
        ⚠️ 竞赛进行中：大家投票 | 竞赛结束后：公布获奖作品
    </p>
</div>
```

#### 竞赛选择器更新
```html
<div class="contest-selector">
    <label>选择竞赛：</label>
    <select id="contestSelect" onchange="worksApp.loadWorks()">
        <option value="">加载中...</option>
    </select>
    <span id="contestStatus" style="margin-left: 20px; font-weight: bold;"></span>
</div>
```

## 用户体验优化

### 公平性保障
1. **进行中不公布排名**：避免投票者受排名影响
2. **实时票数显示**：保持透明度
3. **自由投票**：可以随时投票和取消投票

### 清晰的时间线
1. **投票阶段**（竞赛进行中）
   - 🔵 投票进行中
   - 不显示排名和获奖信息
   - 鼓励用户积极投票

2. **评选阶段**（竞赛结束后）
   - ⚫ 已结束，奖项已公布
   - 显示获奖作品区域
   - 显示排名徽章

### 视觉引导
- **状态标识**：使用颜色和图标区分状态
- **说明文字**：清晰告知评选规则
- **动态显示**：根据状态自动切换显示内容

## 技术实现

### 状态判断
```javascript
currentContest.status === 'ongoing'  // 进行中
currentContest.status === 'ended'    // 已结束
```

### 条件渲染
根据竞赛状态动态控制：
- 获奖区域显示/隐藏
- 排名徽章显示/隐藏
- 状态提示文字

## 数据流程

1. **加载竞赛列表** → 获取所有竞赛
2. **选择竞赛** → 检查竞赛状态
3. **更新状态提示** → 显示当前状态
4. **加载作品** → 获取投稿作品
5. **渲染作品** → 根据状态决定是否显示排名
6. **渲染获奖** → 仅在已结束时显示

## 总结

此次更新确保了评选流程的公平性和透明度：

✅ **进行中**：专注投票，不受排名干扰
✅ **已结束**：公布结果，展示获奖作品
✅ **状态清晰**：用户随时知道当前阶段
✅ **自动控制**：无需手动管理显示逻辑

这种设计符合竞赛的公平原则，让投票更加客观真实。
