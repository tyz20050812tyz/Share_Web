# 以史为鉴，凝聚力量 - 项目介绍文档

<div align="center">

![项目Logo](https://img.shields.io/badge/以史为鉴-凝聚力量-c62828?style=for-the-badge)
![技术栈](https://img.shields.io/badge/Tech-Node.js%20%7C%20Express%20%7C%20HTML5%20%7C%20Canvas-blue?style=for-the-badge)

**一个集知识学习、互动体验、创作分享于一体的综合性历史教育平台**

</div>

---

## 📋 目录

- [项目概述](#-项目概述)
- [核心功能模块](#-核心功能模块)
- [特色亮点](#-特色亮点)
- [技术创新点](#-技术创新点)
- [用户系统](#-用户系统)
- [数据存储架构](#-数据存储架构)
- [API接口文档](#-api接口文档)
- [项目架构](#-项目架构)
- [主题样式规范](#-主题样式规范)
- [快速开始](#-快速开始)
- [常见问题](#-常见问题)

---

## 🎯 项目概述

### 项目背景

本项目围绕"反法西斯战争胜利精神与中华民族伟大复兴内在逻辑"这一主题，构建了一个多维度、交互式的历史教育平台。

### 核心目标

1. **知识传播**：系统梳理反法西斯战争胜利精神的核心内涵
2. **互动学习**：通过游戏化、可视化方式提升体验
3. **文化传承**：利用AI技术实现历史人物角色扮演
4. **社区共建**：构建讨论区和创作平台
5. **技术创新**：融合AI问答、3D展示、Canvas游戏

---

## 🚀 核心功能模块

### 1. 智能问答系统（ai.html）

基于DeepSeek大语言模型，专注解答反法西斯战争胜利精神相关问题。

**核心特性**：
- 专业角色"小史鉴"
- 四大知识框架
- 内在逻辑关系分析
- Mock模式支持

### 2. 互动学习中心（challenge.html）

#### 知识答题挑战
- 2分钟限时答题
- 150道题库
- 不重复机制
- 多用户排行榜

#### AI历史人物对话
- 8位历史人物角色
- 真实人物头像
- 角色专属Prompt
- 沉浸式体验

### 3. 趣味射击游戏（game.html）

基于Canvas的答题射击游戏。

**游戏机制**：
- 三种难度（简单/普通/困难）
- 答题击落敌机
- 生命值系统
- 150道题目

**音频系统**：
- 6首背景音乐轮播
- 独立音效和音乐开关
- 音乐信息显示

### 4. 3D历史文物展馆（models.html）

**展品特性**：
- 6个Sketchfab 3D模型
- 360°全景浏览
- 交互式操作
- 所有文字黑色（用户偏好）

### 5. 创作竞赛平台（contest.html）

**竞赛管理**（管理员）：
- 创建/编辑/删除竞赛
- 状态管理

**作品投稿**（用户）：
- 多种作品类型
- 草稿保存
- 投票系统
- 浏览量统计

### 6. 历史上的今天（history_today.html）

**核心功能**：
- 根据日期自动展示历史事件
- 重要纪念日高亮
- 日历选择
- 与AI对话联动

### 7. 主题讨论区（discuss.html）

**核心功能**：
- 发帖功能
- 评论系统
- 点赞系统
- 管理员权限（置顶/删除）

### 8. 知识分享中心（knowledge.html）

以时间轴形式展示历史节点和逻辑关系。

### 9. 文化传播（culture.html）

AI生成主题歌曲，支持播放与下载。

### 10. 个人中心（profile.html）

**核心模块**：
- 游戏战绩
- 学习记录
- 创作投稿
- 讨论参与
- 我的留言

### 11. 用户留言箱（guestbook.html）

**功能**：
- 用户间留言交流
- 留言管理
- 仅通过个人中心访问

---

## ✨ 特色亮点

### 1. AI历史人物角色扮演
利用大语言模型实现历史人物"复活"，每位人物拥有定制化system prompt。

### 2. 题库共享机制
150道题支撑射击游戏和答题挑战两个模块。

### 3. 成就系统
覆盖游戏、学习、创作、社区四大模块。

### 4. 游戏化学习
将被动学习转化为主动游戏体验。

### 5. 多维度数据统计
个人中心统一展示用户各模块数据。

---

## 🔬 技术创新点

### 1. 前后端分离架构
纯静态前端 + Node.js/Express后端 + RESTful API

### 2. Mock与真实API无缝切换
通过`ENABLE_MOCK`配置自动切换

### 3. 文件持久化存储
JSON文件存储，无需数据库

### 4. Canvas游戏引擎
原生Canvas 2D API自主实现

### 5. 在线人数实时统计
心跳机制 + 过期检测

### 6. 权限控制系统
管理员/普通用户角色权限

### 7. 响应式设计
适配桌面、平板、手机

### 8. 前端资源缓存控制
版本号参数强制刷新

---

## 👥 用户系统

### 注册与登录

**注册流程**：访问register.html → 输入信息 → 后端验证 → 写入users.json

**登录流程**：访问login.html → 验证账号密码 → 存储localStorage → 跳转主页

**忘记密码**：三步式验证（账号验证 → 旧密码验证 → 新密码设置）

### 访问控制

**全局拦截**（main.js）：
- 白名单页面无需登录
- 其他页面需登录访问
- 未登录自动跳转登录页

**用户栏**：显示用户名、角色、在线人数、退出按钮

### 默认账号

**管理员**：
- 账号：佟雨泽
- 密码：20050812
- 角色：admin

---

## 💾 数据存储架构

### 前端存储（localStorage）

```javascript
{
  "login_user": "用户名",
  "login_role": "user/admin",
  "game_stats_用户名": {...},  // 游戏数据
  "quiz_stats_用户名": {...}   // 答题数据
}
```

### 后端存储（JSON文件）

- **users.json**：用户账号信息
- **forum.json**：讨论区数据
- **contests.json**：竞赛数据（格式：`{ "contests": [] }`）
- **submissions.json**：投稿数据（包含voters数组）
- **quiz_rankings.json**：排行榜数据
- **history_events.json**：历史事件数据
- **guestbook.json**：留言数据

---

## 📡 API接口文档

### 用户相关

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/register | POST | 用户注册 |
| /api/login | POST | 用户登录 |
| /api/check-account | POST | 检查账号存在 |
| /api/verify-password | POST | 验证旧密码 |
| /api/reset-password | POST | 重置密码 |

### 在线状态

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/online/heartbeat | POST | 心跳上报 |
| /api/online/offline | POST | 下线通知 |
| /api/online/count | GET | 获取在线人数 |

### AI问答

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/ask | POST | 提问 |
| /api/config/status | GET | 获取配置状态 |

### 讨论区

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/forum/posts | GET | 获取帖子列表 |
| /api/forum/post | POST | 发表新帖 |
| /api/forum/like | POST | 点赞 |
| /api/forum/pin | POST | 置顶（管理员）|
| /api/forum/delete | POST | 删除（管理员）|

### 答题排行榜

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/quiz/rankings | GET | 获取排行榜 |
| /api/quiz/submit-score | POST | 提交成绩 |

### 创作竞赛

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/contests | GET | 获取所有竞赛 |
| /api/contests | POST | 创建竞赛（管理员）|
| /api/submissions | GET | 获取投稿列表 |
| /api/submissions | POST | 提交作品 |
| /api/submissions/:id | GET | 获取作品详情 |
| /api/submissions/:id/vote | POST | 投票 |
| /api/submissions/:id/view | POST | 增加浏览量 |

### 历史事件

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/history/events | GET | 获取所有事件 |
| /api/history/events?date=MM-DD | GET | 按日期查询 |

### 留言箱

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/guestbook | GET | 获取留言列表 |
| /api/guestbook | POST | 发送留言 |

---

## 🏗️ 项目架构

### 目录结构

```
网站/
├── server/                  # 后端服务
│   ├── index.js            # 服务入口（1300+行）
│   ├── package.json        # 依赖配置
│   ├── config.local.json   # 本地配置
│   └── *.json              # 数据文件
├── index.html              # 主页
├── ai.html                 # 智能问答
├── challenge.html          # 互动学习
├── game.html               # 射击游戏
├── models.html             # 3D展馆
├── contest.html            # 创作竞赛
├── contest_works.html      # 作品展示
├── history_today.html      # 历史上的今天
├── discuss.html            # 讨论区
├── knowledge.html          # 知识分享
├── culture.html            # 文化传播
├── profile.html            # 个人中心
├── guestbook.html          # 留言箱
├── login.html              # 登录
├── register.html           # 注册
├── forgot.html             # 忘记密码
├── style.css               # 全局样式
├── main.js                 # 通用脚本
├── *.js                    # 各页面逻辑
├── images/                 # 图片资源
├── 歌曲/                   # 音频资源
├── run_website.bat         # Windows启动脚本
├── stop_website.bat        # 停止脚本
├── README.md               # 项目说明
├── DEPLOYMENT_GUIDE.md     # 部署指南
└── PROJECT_INTRODUCTION.md # 本文档
```

### 技术栈

**前端**：
- HTML5（语义化标签、Canvas API）
- CSS3（变量、Flexbox、Grid、动画）
- JavaScript ES6+（Fetch、localStorage、async/await）

**后端**：
- Node.js ≥16
- Express（Web框架）
- node-fetch（HTTP请求）
- fs（文件系统）

**第三方服务**：
- DeepSeek API（大语言模型）
- Sketchfab（3D模型嵌入）

---

## 🎨 主题样式规范

### CSS变量（style.css）

```css
:root {
  /* 主色 */
  --accent: #c62828;        /* 主强调色（红色）*/
  --accent-light: #e53935;
  --accent-dark: #8e0000;
  
  /* 灰阶 */
  --bg: #c62828;            /* 全站红色背景 */
  --surface: #ffffff;       /* 卡片背景 */
  --border: #e5e9f2;        /* 边框颜色 */
  --muted: #6b7280;         /* 次要文本 */
  --text: #111827;          /* 正文颜色 */
  
  /* 圆角 & 阴影 */
  --radius: 12px;
  --shadow-sm: 0 1px 2px 0 rgba(0 0 0 / .05);
  --shadow: 0 4px 12px -2px rgba(0 0 0 / .08);
  --shadow-lg: 0 10px 24px -4px rgba(0 0 0 / .12);
  
  /* 动效 */
  --transition: all .25s cubic-bezier(.4, 0, .2, 1);
}
```

### 全站红色层次背景

```css
body {
  background: radial-gradient(...), linear-gradient(...);
}
```

### 响应式断点

- 桌面端：> 768px
- 平板端：≤ 768px
- 手机端：≤ 480px

### 设计规范

- **3D页面文字**：统一使用黑色
- **导航栏**：所有页面保持一致
- **卡片样式**：统一使用`--radius`和`--shadow`
- **按钮交互**：hover效果使用`transform: translateY(-2px)`

---

## 🚀 快速开始

### 系统要求

- Node.js ≥ 16
- npm ≥ 7
- 浏览器：Chrome/Firefox/Edge最新版

### 启动方式

#### Windows一键启动（推荐）

```bash
双击 run_website.bat
```

自动：
- 检测Node.js环境
- 安装依赖
- 启动服务（端口3000）
- 打开浏览器

#### 命令行启动

```bash
cd server
npm install
npm start
```

#### 自定义端口

```bash
# PowerShell
$env:PORT = "4000"
npm start

# CMD
set PORT=4000 && npm start
```

#### 停止服务

```bash
双击 stop_website.bat
```

或手动终止Node.js进程。

### 配置DeepSeek API（可选）

编辑`server/config.local.json`：

```json
{
  "DEEPSEEK_API_URL": "https://api.deepseek.com/v1/chat/completions",
  "DEEPSEEK_API_KEY": "YOUR_API_KEY_HERE",
  "DEEPSEEK_MODEL": "deepseek-chat",
  "ENABLE_MOCK": "false",
  "ONLINE_TIMEOUT_MS": 120000
}
```

**配置项说明**：
- `DEEPSEEK_API_KEY`：API密钥（必须替换）
- `ENABLE_MOCK`：`true`使用Mock模式，`false`调用真实API
- `ONLINE_TIMEOUT_MS`：在线心跳超时时间（毫秒）

---

## ❓ 常见问题

### Q: 自动打开浏览器失败？
A: 手动访问 `http://localhost:3000/`

### Q: DeepSeek未配置怎么办？
A: 设置 `ENABLE_MOCK: "true"` 使用演示模式

### Q: 如何清除登录状态？
A: 点击"退出登录"或清除localStorage

### Q: 注册失败（账号已存在）？
A: 更换用户名或编辑`server/users.json`删除重复账号

### Q: 在线人数不更新？
A: 等待20秒刷新周期或重新登录

### Q: 端口被占用？
A: 运行`stop_website.bat`或使用自定义端口

### Q: 题目重复出现？
A: 检查浏览器控制台是否有加载错误

### Q: 游戏背景音乐不播放？
A: 检查`./歌曲/`目录是否存在音频文件

---

## 📝 开发规范

### 页面结构规范

所有页面必须包含：
```html
<header class="site-header">...</header>
<div class="user-bar" id="userBar"></div>
<main class="wrap">...</main>
<footer class="site-footer">...</footer>
```

### 导航栏规范

保持所有页面导航链接内容、顺序一致。

### 资源引用规范

根目录资源直接引用文件名：
```html
<script src="game.js"></script>
<link rel="stylesheet" href="style.css">
```

### 版本号控制

修改代码后更新版本号：
```html
<script src="game.js?v=2.0"></script>
```

### 数据加载规范

- 优先从服务端API加载
- 避免硬编码静态数据
- 使用async/await

---

## 🔄 更新日志

### v6.0 (2025-11-04)
- ✨ 新增留言箱功能
- ✨ 个人中心新增"我的留言"模块
- 📚 完善项目介绍文档
- 📚 新增部署指南文档

### v5.0 (2025-11-02)
- ✨ AI历史人物对话使用真实头像
- ✨ 优化头像显示样式
- 🎨 统一人物卡片样式

### v4.0
- ✨ 答题题库扩展到150题
- ✨ 实现题目不重复机制
- 🔧 题库与射击游戏共享

### v3.0
- ✨ 找回密码功能
- 🐛 修复forgot.js语法错误
- 🔧 个人中心创作记录从服务器加载

### v2.0
- ✨ 个人中心完整版
- ✨ 创作竞赛平台
- ✨ 互动学习中心
- ✨ 3D文物展馆
- ✨ 历史上的今天

### v1.0
- 🎉 项目初始版本
- ✨ 基础页面和导航
- ✨ 用户系统
- ✨ 讨论区功能

---

## 📄 许可证

本项目仅用于教育学习目的。

## 👥 贡献者

- 项目开发：佟雨泽
- 测试与反馈：十三组全体成员

## 📞 联系方式

- Email: 2976761680@qq.com
- GitHub: https://github.com/tyz20050812tyz
- WeChat: KeVInWduranT35
- QQ: 2976761680
- Phone: 15241259488

---

**以史为鉴，凝聚力量** - 让红色文化在新时代焕发光彩 🇨🇳
