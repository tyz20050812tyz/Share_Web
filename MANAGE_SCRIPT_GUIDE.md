# 网站服务管理脚本使用指南

## 📋 目录

- [脚本概述](#脚本概述)
- [功能说明](#功能说明)
- [运行环境要求](#运行环境要求)
- [使用方法](#使用方法)
- [功能详解](#功能详解)
- [预期输出与状态提示](#预期输出与状态提示)
- [常见问题及解决方案](#常见问题及解决方案)
- [最佳实践](#最佳实践)

---

## 🎯 脚本概述

**脚本名称**：`manage_website.bat`  
**版本**：v1.0  
**功能**：提供网站服务的启动、停止、重启、状态查看和端口配置的统一管理界面

### 整合内容

本脚本整合了原有的两个独立脚本：
- ✅ `run_website.bat` - 服务启动功能
- ✅ `stop_website.bat` - 服务停止功能

同时新增了：
- 🆕 交互式菜单界面
- 🆕 服务重启功能
- 🆕 服务状态查看
- 🆕 端口动态配置
- 🆕 智能错误提示

---

## ⚙️ 功能说明

### 核心功能

| 功能编号 | 功能名称 | 说明 |
|---------|---------|------|
| **1** | 启动服务 | 检查环境 → 安装依赖 → 启动服务器 → 打开浏览器 |
| **2** | 停止服务 | 查找Node.js进程 → 终止进程 → 检查端口释放 |
| **3** | 重启服务 | 停止现有服务 → 等待3秒 → 重新启动服务 |
| **4** | 查看状态 | 检查Node.js环境 → 查看进程状态 → 检查端口占用 |
| **5** | 修改端口 | 交互式修改服务监听端口（默认3000） |
| **0** | 退出程序 | 安全退出管理脚本 |

---

## 💻 运行环境要求

### 必需环境

#### 1. 操作系统
- **支持系统**：Windows 7 / 10 / 11 / Server 2012+
- **推荐系统**：Windows 10 或更高版本
- **编码支持**：脚本自动设置UTF-8编码（chcp 65001）

#### 2. Node.js 环境
- **版本要求**：Node.js ≥ 16.0.0
- **包管理器**：npm ≥ 7.0.0
- **安装检查**：脚本会自动检测，未安装时提示下载
- **下载地址**：https://nodejs.org/

#### 3. 系统权限
- **普通操作**：无需管理员权限
- **特殊情况**：
  - 端口 < 1024：需要管理员权限
  - 进程终止失败：建议使用管理员权限运行

### 可选依赖

- **浏览器**：Chrome / Edge / Firefox（自动打开服务页面）
- **网络连接**：首次运行需联网安装依赖包

---

## 🚀 使用方法

### 基本使用

#### 方式一：双击运行（推荐）

1. 在文件资源管理器中找到 `manage_website.bat`
2. 双击运行脚本
3. 根据菜单提示选择操作（输入数字0-5）

#### 方式二：命令行运行

```batch
# 进入项目目录
cd "你的项目路径"

# 运行管理脚本
manage_website.bat
```

### 快速启动流程

```
启动脚本 → 输入 1 → 等待环境检查 → 自动打开浏览器 → 完成
```

### 快速停止流程

```
启动脚本 → 输入 2 → 等待进程终止 → 完成
```

---

## 📖 功能详解

### 1️⃣ 启动服务

**操作步骤**：
1. 在主菜单输入 `1`
2. 脚本自动执行以下检查：
   - 检查是否已有服务运行（提示是否停止）
   - 检查Node.js环境（未安装时提示下载）
   - 进入`server`目录
   - 检查并安装依赖包（首次运行）
   - 启动服务器（新窗口）
   - 打开浏览器访问服务

**预期输出**：
```
╔════════════════════════════════════════╗
║           启动网站服务                 ║
╚════════════════════════════════════════╝

[1/5] 检查服务状态...
✓ 未检测到运行中的服务

[2/5] 检查Node.js环境...
v18.17.0
✓ Node.js环境检测通过

[3/5] 进入服务器目录...
✓ 当前目录: D:\项目\网站\server

[4/5] 检查并安装依赖...
✓ 依赖包已存在，跳过安装

[5/5] 启动服务 (端口: 3000)...
✓ 服务已在新窗口中启动

[INFO] 正在打开浏览器...

════════════════════════════════════════
 服务启动成功！
 访问地址: http://localhost:3000
 服务端口: 3000
════════════════════════════════════════
```

**注意事项**：
- 首次运行会自动安装依赖包，耗时约1-3分钟
- 服务器会在新窗口中运行，请勿关闭该窗口
- 如果浏览器未自动打开，请手动访问提示的URL

---

### 2️⃣ 停止服务

**操作步骤**：
1. 在主菜单输入 `2`
2. 脚本自动执行：
   - 查找所有Node.js进程
   - 强制终止所有Node.js进程
   - 检查端口释放情况
   - 显示结果

**预期输出**：
```
╔════════════════════════════════════════╗
║           停止网站服务                 ║
╚════════════════════════════════════════╝

[1/2] 正在查找Node.js进程...

找到运行中的Node.js进程：
映像名称                       PID 会话名              会话#       内存使用
========================= ======== ================ =========== ============
node.exe                     12345 Console                    1     85,432 K

正在停止进程...
✓ 成功停止所有Node.js进程

[2/2] 检查端口占用情况...

✓ 端口 3000, 3001, 3002 已全部释放

════════════════════════════════════════
 服务已停止
════════════════════════════════════════
```

**警告场景**：
如果端口仍被占用，会显示：
```
警告：以下端口仍被占用：
  TCP    0.0.0.0:3000           0.0.0.0:0              LISTENING       5678

[提示] 可能存在其他程序占用端口
```

---

### 3️⃣ 重启服务

**操作步骤**：
1. 在主菜单输入 `3`
2. 自动执行：停止服务 → 等待3秒 → 启动服务

**适用场景**：
- 修改代码后需要重新加载
- 服务出现异常需要重启
- 更改配置文件后生效

**预期输出**：
```
╔════════════════════════════════════════╗
║           重启网站服务                 ║
╚════════════════════════════════════════╝

[步骤1] 停止现有服务...
...（停止服务输出）

[步骤2] 等待3秒...

[步骤3] 启动新服务...
...（启动服务输出）
```

---

### 4️⃣ 查看状态

**操作步骤**：
1. 在主菜单输入 `4`
2. 查看完整的系统状态

**检查项目**：
- Node.js环境及版本
- npm环境及版本
- Node.js进程运行状态
- 端口占用情况（3000/3001/3002）

**预期输出**：
```
╔════════════════════════════════════════╗
║           服务状态检查                 ║
╚════════════════════════════════════════╝

[1/4] Node.js环境检查
────────────────────────────────────────
✓ Node.js: v18.17.0

[2/4] npm环境检查
────────────────────────────────────────
✓ npm: v9.6.7

[3/4] Node.js进程状态
────────────────────────────────────────
✓ 服务状态: 运行中

进程列表:
映像名称                       PID 会话名              会话#       内存使用
========================= ======== ================ =========== ============
node.exe                     12345 Console                    1     85,432 K

[4/4] 端口占用检查
────────────────────────────────────────
端口占用情况:
  TCP    0.0.0.0:3000           0.0.0.0:0              LISTENING       12345

════════════════════════════════════════
 状态检查完成
════════════════════════════════════════
```

**使用建议**：
- 启动失败时先查看状态
- 排查问题时的第一步
- 确认环境配置是否正确

---

### 5️⃣ 修改端口

**操作步骤**：
1. 在主菜单输入 `5`
2. 查看当前端口
3. 输入新端口号（或留空取消）
4. 确认修改

**端口选择建议**：
- **默认端口**：3000
- **备选端口**：3001, 8080, 8888
- **有效范围**：1-65535
- **建议范围**：3000-9999

**预期输出**：
```
╔════════════════════════════════════════╗
║           修改服务端口                 ║
╚════════════════════════════════════════╝

当前端口: 3000

建议端口范围: 3000-9999
常用端口: 3000, 3001, 8080, 8888

请输入新端口号 (留空取消): 8080

✓ 端口已修改为: 8080

[提示] 如果服务正在运行，请重启服务使端口生效
```

**注意事项**：
- 端口修改后需重启服务才能生效
- 小于1024的端口可能需要管理员权限
- 避免使用已被其他程序占用的端口

---

### 0️⃣ 退出程序

**操作步骤**：
1. 在主菜单输入 `0`
2. 脚本显示退出信息后自动关闭

**预期输出**：
```
════════════════════════════════════════
 感谢使用网站服务管理工具
 Goodbye!
════════════════════════════════════════
```

---

## 📊 预期输出与状态提示

### 状态符号说明

| 符号 | 含义 | 说明 |
|------|------|------|
| ✓ | 成功 | 操作成功完成 |
| ✗ | 失败 | 操作失败或检测到问题 |
| [INFO] | 信息 | 一般性信息提示 |
| [警告] | 警告 | 需要注意但不影响运行 |
| [错误] | 错误 | 严重问题，需要处理 |
| [提示] | 建议 | 操作建议或提示 |

### 进度提示格式

```
[步骤编号/总步骤数] 当前操作描述...
```

例如：
- `[1/5] 检查服务状态...`
- `[2/4] npm环境检查`

### 分隔线与边框

- **主标题边框**：`╔═══╗` / `║ 标题 ║` / `╚═══╝`
- **分隔线**：`════════════════════════════════════════`
- **子分隔线**：`────────────────────────────────────────`

---

## ❓ 常见问题及解决方案

### 问题 1：Node.js未安装

**症状**：
```
[错误] 未检测到Node.js环境

请先安装Node.js (版本 >= 16)
下载地址：https://nodejs.org/
```

**解决方案**：
1. **自动方式**：脚本提示时输入 `Y` 自动打开下载页面
2. **手动方式**：
   - 访问 https://nodejs.org/
   - 下载LTS版本（推荐v18或v20）
   - 运行安装程序，确保勾选"Add to PATH"
   - 重启命令行窗口

**验证安装**：
```batch
node --version
npm --version
```

---

### 问题 2：端口被占用

**症状A：启动时提示服务已运行**
```
[警告] 检测到Node.js进程已在运行

是否先停止现有服务？(Y/N):
```

**解决方案**：
- 输入 `Y`：自动停止旧服务并启动新服务
- 输入 `N`：取消启动操作

**症状B：停止服务后端口仍被占用**
```
警告：以下端口仍被占用：
  TCP    0.0.0.0:3000           0.0.0.0:0              LISTENING       5678
```

**解决方案**：

**方法一：使用脚本修改端口**
1. 在主菜单选择 `5`（修改端口）
2. 输入未被占用的端口（如3001, 8080）
3. 重启服务

**方法二：手动释放端口**
```batch
# 1. 查找占用端口的进程ID（PID）
netstat -ano | findstr :3000

# 2. 终止该进程（替换<PID>为实际进程号）
taskkill /F /PID <PID>
```

**方法三：使用任务管理器**
1. 按 `Ctrl+Shift+Esc` 打开任务管理器
2. 切换到"详细信息"标签
3. 找到占用端口的进程（通过PID）
4. 右键 → 结束任务

---

### 问题 3：依赖安装失败

**症状**：
```
[错误] 依赖安装失败

可能的原因：
 - 网络连接问题
 - npm镜像源访问慢

建议：切换到淘宝镜像
 npm config set registry https://registry.npmmirror.com
```

**解决方案**：

**方法一：切换国内镜像（推荐）**
```batch
# 临时使用淘宝镜像
npm install --registry=https://registry.npmmirror.com

# 永久切换到淘宝镜像
npm config set registry https://registry.npmmirror.com

# 验证镜像源
npm config get registry
```

**方法二：清除缓存重试**
```batch
# 清除npm缓存
npm cache clean --force

# 删除node_modules重新安装
cd server
rmdir /s /q node_modules
del package-lock.json
npm install
```

**方法三：检查网络连接**
- 确保电脑联网
- 关闭VPN或代理（可能影响npm访问）
- 检查防火墙设置

---

### 问题 4：权限不足

**症状A：进程终止失败**
```
✗ 停止进程时出现错误

[建议] 请尝试以管理员身份运行此脚本
```

**解决方案**：
1. 右键点击 `manage_website.bat`
2. 选择"以管理员身份运行"
3. 在UAC提示中点击"是"

**症状B：端口无法绑定（小于1024）**
```
[警告] 端口号小于1000可能需要管理员权限
```

**解决方案**：
- **推荐**：使用大于1024的端口（如3000, 8080）
- **必须使用小端口**：以管理员身份运行脚本

---

### 问题 5：服务器目录不存在

**症状**：
```
[错误] 无法进入目录: D:\项目\网站\server
```

**解决方案**：
1. **检查脚本位置**：确保脚本在项目根目录
2. **检查目录结构**：确认`server`文件夹存在且位于项目根目录
3. **重新解压项目**：如果是压缩包，确保完整解压

**正确的目录结构**：
```
项目根目录/
├── manage_website.bat    ← 脚本位置
├── server/                ← 服务器目录
│   ├── index.js
│   ├── package.json
│   └── ...
├── index.html
└── ...
```

---

### 问题 6：浏览器未自动打开

**症状**：
```
[INFO] 正在打开浏览器...
（浏览器没有打开）
```

**解决方案**：
1. **手动访问**：打开浏览器，输入控制台显示的URL
   ```
   http://localhost:3000
   ```

2. **设置默认浏览器**：
   - Windows设置 → 应用 → 默认应用 → Web浏览器
   - 选择Chrome/Edge/Firefox

3. **检查浏览器安装**：确保电脑已安装浏览器

---

### 问题 7：修改代码后不生效

**症状**：
- 修改了代码文件
- 刷新浏览器后没有变化

**解决方案**：

**方法一：重启服务（推荐）**
1. 在脚本主菜单选择 `3`（重启服务）
2. 等待重启完成
3. 刷新浏览器（`Ctrl+F5` 强制刷新）

**方法二：清除浏览器缓存**
- Chrome：`Ctrl+Shift+Delete` → 清除缓存
- 或使用无痕模式：`Ctrl+Shift+N`

**方法三：检查文件保存**
- 确认文件已保存（编辑器中无*标记）
- 检查是否修改了正确的文件

---

### 问题 8：中文乱码

**症状**：
- 控制台显示乱码
- 中文变成问号或方框

**解决方案**：
1. **自动修复**：脚本已自动设置UTF-8编码（`chcp 65001`）
2. **手动设置**：在命令行执行
   ```batch
   chcp 65001
   ```
3. **更改控制台字体**：
   - 右键控制台标题栏 → 属性
   - 字体选择：`Consolas` 或 `Microsoft YaHei Mono`

---

### 问题 9：服务运行缓慢

**症状**：
- 启动时间过长
- 页面响应慢

**可能原因与解决方案**：

**原因1：首次安装依赖**
- 首次运行需要下载依赖包，耗时1-3分钟
- 解决：等待安装完成，后续运行会很快

**原因2：杀毒软件扫描**
- 杀毒软件实时扫描node_modules
- 解决：将项目目录添加到白名单

**原因3：磁盘空间不足**
- 解决：清理磁盘，确保至少500MB可用空间

**原因4：电脑性能不足**
- 解决：关闭其他占用资源的程序

---

## 💡 最佳实践

### 日常使用建议

#### 开发流程

```
1. 启动开发
   └─ 运行脚本 → 选择 1（启动服务）

2. 修改代码
   └─ 编辑文件 → 保存

3. 查看效果
   └─ 选择 3（重启服务）→ 刷新浏览器

4. 结束工作
   └─ 选择 2（停止服务）→ 退出脚本
```

#### 快速重启快捷方式

创建 `restart.bat` 快捷脚本：
```batch
@echo off
taskkill /F /IM node.exe /T >nul 2>&1
timeout /t 2 >nul
cd server
start "Server" cmd /c "set PORT=3000 && npm start"
echo 服务已重启
pause
```

### 性能优化建议

1. **使用SSD**：将项目放在SSD上，启动速度更快
2. **关闭实时扫描**：将项目目录添加到杀毒软件白名单
3. **定期清理**：删除不需要的node_modules文件夹
4. **使用镜像源**：永久切换到国内镜像，提升下载速度

### 安全建议

1. **不要以管理员身份运行**：除非必要
2. **定期备份**：备份server目录下的JSON数据文件
3. **检查端口**：不要使用已知的服务端口（如80, 443, 3306）
4. **关闭不用的服务**：开发结束后及时停止服务

### 团队协作建议

1. **统一端口**：团队成员使用相同端口（如3000）
2. **文档同步**：将此文档分享给所有成员
3. **问题反馈**：遇到问题先查看本文档FAQ
4. **版本控制**：不要将`node_modules`提交到Git

---

## 📞 技术支持

### 问题反馈

如果遇到本文档未涵盖的问题，请联系：
- **Email**：2976761680@qq.com
- **QQ**：2976761680
- **Phone**：15241259488

### 更新日志

**v1.0 (2025-11-04)**
- ✨ 初始版本发布
- ✨ 整合启动和停止脚本
- ✨ 新增交互式菜单
- ✨ 新增重启和状态查看功能
- ✨ 新增端口动态配置
- 📚 完善使用文档

---

## 📄 附录

### 相关文件说明

| 文件名 | 说明 | 位置 |
|--------|------|------|
| `manage_website.bat` | 统一管理脚本 | 项目根目录 |
| `run_website.bat` | 旧版启动脚本（已整合） | 项目根目录 |
| `stop_website.bat` | 旧版停止脚本（已整合） | 项目根目录 |
| `server/index.js` | 服务器主程序 | server目录 |
| `server/package.json` | 依赖配置文件 | server目录 |
| `DEPLOYMENT_GUIDE.md` | 完整部署指南 | 项目根目录 |

### 兼容性说明

**已测试系统**：
- ✅ Windows 10 21H2
- ✅ Windows 11 22H2
- ✅ Windows Server 2019

**已测试Node.js版本**：
- ✅ Node.js v16.20.0
- ✅ Node.js v18.17.0
- ✅ Node.js v20.10.0

### 脚本维护

本脚本为开源教育项目，欢迎提交改进建议。

---

**最后更新**：2025-11-04  
**文档版本**：v1.0  
**作者**：佟雨泽
